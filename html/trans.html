<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiktok-æ ‡é¢˜ä¼˜åŒ–å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 h-screen flex items-center justify-center">

    <div class="w-full max-w-2xl bg-white p-8 rounded-xl shadow-xl">
        <h2 class="text-2xl font-bold text-center mb-6">ğŸ“Š Tiktokå°è¯­ç§å›½å®¶æ ‡é¢˜ä¼˜åŒ–</h2>

        <!-- é€‰æ‹©æ–‡ä»¶ 1 -->
        <label class="file-upload block text-center">
            <input type="file" id="file1" class="hidden" onchange="updateFileName(this, 'file-label-1')">
            <div class="custom-upload-btn">
                <span id="file-label-1">ğŸ“‚ å…¨çƒå•†å“æ•°æ®ä¸Šä¼ ã€åŸºç¡€ä¿¡æ¯ã€‘</span>
            </div>
        </label>

        <!-- é€‰æ‹©æ–‡ä»¶ 2 -->
        <label class="file-upload block text-center mt-4">
            <input type="file" id="file2" class="hidden" onchange="updateFileName(this, 'file-label-2')">
            <div class="custom-upload-btn">
                <span id="file-label-2">ğŸ“‚ å›½å®¶å•†å“ä¿¡æ¯ä¸Šä¼ ã€å…¨éƒ¨ä¿¡æ¯ã€‘ </span>
            </div>
        </label>

        <!-- è¯­è¨€é€‰æ‹© -->
        <input type="text" id="language" placeholder="è¯·è¾“å…¥ç›®æ ‡è¯­è¨€ï¼ˆå¦‚ï¼šé©¬æ¥è¯­ï¼‰" class="w-full border p-3 rounded-md mt-6 focus:ring focus:ring-blue-300 text-center">

        <!-- æäº¤æŒ‰é’® -->
        <button id="submit-btn" class="w-full bg-blue-600 text-white py-3 mt-6 rounded-lg hover:bg-blue-700 transition">
            ğŸš€ å¼€å§‹è½¬æ¢
        </button>

        <!-- è¿›åº¦æ¡ -->
        <div id="progress-container" class="hidden w-full bg-gray-200 mt-6 rounded-md">
            <div id="progress-bar" class="bg-blue-500 h-2 rounded-md" style="width: 0%;"></div>
        </div>
        <p id="progress-text" class="text-center mt-2 text-gray-600"></p >

        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <p id="status" class="text-center mt-4 text-lg font-semibold"></p >

        <!-- ä¸‹è½½é“¾æ¥ -->
        <a id="download-link" class="hidden text-center block mt-4 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition">
            ğŸ“¥ ç‚¹å‡»ä¸‹è½½è½¬æ¢åçš„ Excel
        </a >
    </div>

    <script>
        function updateFileName(input, labelId) {
            let fileName = input.files.length > 0 ? input.files[0].name : "ğŸ“‚ è¯·é€‰æ‹© Excel æ–‡ä»¶";
            document.getElementById(labelId).innerText = fileName;
        }
    </script>
    <script>
        document.getElementById("submit-btn").addEventListener("click", function() {
            let file1 = document.getElementById("file1").files.length > 0;
            let file2 = document.getElementById("file2").files.length > 0;
            let language = document.getElementById("language").value.trim();
            let status = document.getElementById("status");

            // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦éƒ½å·²ä¸Šä¼ 
            if (!file1 || !file2) {
                status.innerText = "âš ï¸ è¯·ä¸Šä¼ ä¸¤ä¸ª Excel æ–‡ä»¶ï¼";
                status.style.color = "red";
                return;
            }

            // æ£€æŸ¥æ˜¯å¦è¾“å…¥äº†ç›®æ ‡è¯­è¨€
            if (!language) {
                status.innerText = "âš ï¸ è¯·è¾“å…¥ç›®æ ‡è¯­è¨€ï¼";
                status.style.color = "red";
                return;
            }

            // å¦‚æœéƒ½å·²é€‰æ‹©ï¼Œç»§ç»­æ‰§è¡Œä¸Šä¼ é€»è¾‘
            status.innerText = "â³ æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...";
            status.style.color = "blue";

            // æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼  & è¿›åº¦æ¡
            file_data = document.getElementById("file1").files[0]
            file_data2 =  document.getElementById("file2").files[0]
            simulateUpload(file_data, file_data2, language);
        });

        function simulateUpload(file1, file2, language) {
            let formData = new FormData();
            formData.append("file1", file1);
            formData.append("file2", file2);
            formData.append("language", language);

            let xhr = new XMLHttpRequest();
            xhr.open("POST", "http://127.0.0.1:5000/upload", true);

            xhr.upload.onprogress = function(event) {
            let percent = Math.round((event.loaded / event.total) * 100);
            document.getElementById("progress-container").classList.remove("hidden");
            document.getElementById("progress-bar").style.width = percent + "%";
            document.getElementById("progress-bar").innerText = percent + "%";
        };


            xhr.onload = function() {
            if (xhr.status === 200) {
                document.getElementById("status").innerText = "âœ… è½¬æ¢å®Œæˆï¼";
                document.getElementById("status").style.color = "green";
                let response = JSON.parse(xhr.responseText);
                document.getElementById("download-link").href = response.download_url;
                document.getElementById("download-link").classList.remove("hidden");
            } else {
                document.getElementById("status").innerText = "âŒ å‘ç”Ÿé”™è¯¯ï¼";
                document.getElementById("status").style.color = "red";
            }
        };
        xhr.send(formData);
        }
    </script>

    <style>
        /* è‡ªå®šä¹‰ä¸Šä¼ æŒ‰é’® */
        .file-upload {
            display: block;
        }
        .custom-upload-btn {
            display: inline-block;
            background: linear-gradient(135deg, #4A90E2, #007AFF);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            text-align: center;
            min-width: 200px;
        }
        .custom-upload-btn:hover {
            background: linear-gradient(135deg, #007AFF, #005BBB);
        }
    </style>

</body>
</html>